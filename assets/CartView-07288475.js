import{_ as P,r as f,o as n,c as d,d as e,a as i,g as y,F as v,f as x,t as u,w as $,n as T,h as C,v as E,b as U,i as b,j as N}from"./index-deebbf1e.js";const{VITE_APP_URL:r,VITE_APP_PATH:c}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"week3dean",BASE_URL:"/vue-week6/",MODE:"production",DEV:!1,PROD:!0},w={data(){return{productListData:[],productId:"",cart:{},loadingItem:"",orderData:{user:{name:"",email:"",tel:"",address:""},message:""},isLoading:!1}},methods:{getProductList(){this.isLoading=!0,this.$http.get(`${r}/api/${c}/products/all`).then(t=>{this.productListData=t.data.products}).catch(t=>{alert(t.data.message)}).finally(()=>{this.isLoading=!1})},openProductModal(t){this.loadingItem=t,this.$http.get(`${r}/api/${c}/product/${t}`).then(s=>{this.tempProduct=s.data.product,this.loadingItem=""}).catch(s=>{alert(s.data.message)})},addToCart(t,s=1){const h={product_id:t,qty:s};this.loadingItem=t,this.isLoading=!0,this.$http.post(`${r}/api/${c}/cart`,{data:h}).then(p=>{alert(p.data.message),this.getCartList(),this.loadingItem=""}).catch(p=>{alert(p.response.data.message)}).finally(()=>{this.isLoading=!1})},getCartList(){this.isLoading=!0,this.$http.get(`${r}/api/${c}/cart`).then(t=>{this.cart=t.data.data}).catch(t=>{alert(t.response.data.message)}).finally(()=>{this.isLoading=!1})},updateCartItem(t){const s={product_id:t.product_id,qty:t.qty};this.loadingItem=t.id,this.$http.put(`${r}/api/${c}/cart/${t.id}`,{data:s}).then(h=>{console.log(h),this.getCartList(),this.loadingItem=""}).catch(h=>{alert(h.response.data.message)})},deleteCartItem(t){this.isLoading=!0,this.loadingItem=t.id,this.$http.delete(`${r}/api/${c}/cart/${t.id}`).then(s=>{alert(s.data.message),this.getCartList(),this.loadingItem=""}).catch(s=>{alert(s.response.data.message)}).finally(()=>{this.isLoading=!1})},deleteAllCartItem(){this.isLoading=!0,this.$http.delete(`${r}/api/${c}/carts`).then(t=>{alert(t.data.message),this.getCartList()}).catch(t=>{alert(t.response.data.message)}).finally(()=>{this.isLoading=!1})},isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"請填寫正確的手機號碼格式"},createOrder(){this.isLoading=!0,this.$http.post(`${r}/api/${c}/order`,{data:this.orderData}).then(t=>{console.log(t),this.$refs.form.resetForm(),this.orderData.message="",this.getCartList()}).catch(t=>{alert(t.response.data.message)}).finally(()=>{this.isLoading=!1})}},mounted(){this.getProductList(),this.getCartList()}},A={class:"container"},I={key:0,class:"text-end"},q={class:"table align-middle"},F=e("thead",null,[e("tr",null,[e("th",null,"品項"),e("th",{class:"text-center"},"單價"),e("th",{class:"text-center"},"數量"),e("th",{class:"text-center"},"小計"),e("th")])],-1),M={key:0},S={class:"d-flex align-items-center gap-2"},B={class:"mb-0"},O={class:"mb-0"},R={class:"text-center"},z={class:"input-group input-group-sm"},j={class:"input-group mb-3"},H=["onUpdate:modelValue","onChange","disabled"],G=["value"],J={class:"text-center"},K={class:"text-end"},Q=["onClick","disabled"],W={key:0,class:"fas fa-spinner fa-pulse"},X={key:1},Y=e("tr",null,[e("td",{colspan:"5",class:"text-center"},"目前購物車沒有商品")],-1),Z=[Y],ee=e("td",{colspan:"4",class:"text-end"},"總計",-1),te={class:"text-end"},se=e("td",{colspan:"4",class:"text-end text-success"},"折扣價",-1),ae={class:"text-end text-success"},le={class:"my-5 row justify-content-center"},oe={class:"mb-3"},ie=e("label",{for:"email",class:"form-label"},"Email",-1),ne={class:"mb-3"},de=e("label",{for:"name",class:"form-label"},"收件人姓名",-1),re={class:"mb-3"},ce=e("label",{for:"tel",class:"form-label"},"收件人電話",-1),ue={class:"mb-3"},he=e("label",{for:"address",class:"form-label"},"收件人地址",-1),me={class:"mb-3"},pe=e("label",{for:"message",class:"form-label"},"留言",-1),_e=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function ge(t,s,h,p,l,m){var L,V;const k=f("VueLoading"),_=f("VField"),g=f("ErrorMessage"),D=f("VForm");return n(),d(v,null,[e("div",A,[i(k,{active:l.isLoading,"onUpdate:active":s[0]||(s[0]=a=>l.isLoading=a)},null,8,["active"]),((L=l.cart.carts)==null?void 0:L.length)>0?(n(),d("div",I,[e("button",{class:"btn btn-outline-danger",type:"button",onClick:s[1]||(s[1]=a=>m.deleteAllCartItem())}," 清空購物車 ")])):y("",!0),e("table",q,[F,((V=l.cart.carts)==null?void 0:V.length)>0?(n(),d("tbody",M,[(n(!0),d(v,null,x(l.cart.carts,a=>(n(),d("tr",{key:a.id},[e("td",S,[e("div",{alt:"",style:T([{width:"100px",height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${a.product.imageUrl})`}])},null,4),e("div",null,[e("p",B,u(a.product.title),1),e("p",O,"NT$ "+u(a.product.price),1)])]),e("td",R,"NT$ "+u(a.product.price),1),e("td",null,[e("div",z,[e("div",j,[C(e("select",{name:"",id:"",class:"form-control","onUpdate:modelValue":o=>a.qty=o,onChange:o=>m.updateCartItem(a),disabled:a.id===l.loadingItem},[(n(),d(v,null,x(25,o=>e("option",{value:o,key:o+"123"},u(o),9,G)),64))],40,H),[[E,a.qty]])])])]),e("td",J,"NT$ "+u(a.total),1),e("td",K,[e("button",{type:"button",class:"btn",onClick:o=>m.deleteCartItem(a),disabled:a.id===l.loadingItem},[a.id===l.loadingItem?(n(),d("i",W)):y("",!0),U(" x ")],8,Q)])]))),128))])):(n(),d("tbody",X,Z)),e("tfoot",null,[e("tr",null,[ee,e("td",te,"NT$ "+u(l.cart.total),1)]),e("tr",null,[se,e("td",ae,"NT$ "+u(l.cart.final_total),1)])])])]),e("div",le,[i(D,{ref:"form",class:"col-md-6",onSubmit:m.createOrder},{default:$(({errors:a})=>[e("div",oe,[ie,i(_,{id:"email",name:"email",type:"email",class:b(["form-control",{"is-invalid":a.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:l.orderData.user.email,"onUpdate:modelValue":s[2]||(s[2]=o=>l.orderData.user.email=o)},null,8,["class","modelValue"]),i(g,{name:"email",class:"invalid-feedback"})]),e("div",ne,[de,i(_,{id:"name",name:"姓名",type:"text",class:b(["form-control",{"is-invalid":a.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:l.orderData.user.name,"onUpdate:modelValue":s[3]||(s[3]=o=>l.orderData.user.name=o)},null,8,["class","modelValue"]),i(g,{name:"姓名",class:"invalid-feedback"})]),e("div",re,[ce,i(_,{id:"tel",name:"電話",type:"tel",class:b(["form-control",{"is-invalid":a.電話}]),placeholder:"請輸入電話",rules:m.isPhone,modelValue:l.orderData.user.tel,"onUpdate:modelValue":s[4]||(s[4]=o=>l.orderData.user.tel=o)},null,8,["class","rules","modelValue"]),i(g,{name:"電話",class:"invalid-feedback"})]),e("div",ue,[he,i(_,{id:"address",name:"地址",type:"text",class:b(["form-control",{"is-invalid":a.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:l.orderData.user.address,"onUpdate:modelValue":s[5]||(s[5]=o=>l.orderData.user.address=o)},null,8,["class","modelValue"]),i(g,{name:"地址",class:"invalid-feedback"})]),e("div",me,[pe,C(e("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[6]||(s[6]=o=>l.orderData.message=o)},null,512),[[N,l.orderData.message]])]),_e]),_:1},8,["onSubmit"])])],64)}const be=P(w,[["render",ge]]);export{be as default};
